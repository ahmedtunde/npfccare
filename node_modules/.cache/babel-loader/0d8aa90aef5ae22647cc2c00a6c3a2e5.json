{"ast":null,"code":"import _regeneratorRuntime from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{Fragment,useEffect,useState}from\"react\";import moment from\"moment\";import DOMPurify from\"dompurify\";import{ReactComponent as NothingFoundIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/nothing-found.svg\";import{ReactComponent as SpinnerIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/spinner.svg\";import{ReactComponent as ArrowLeftShortCircleFill}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/arrow-left-short-circle-fill.svg\";import{getCustomerLogs}from\"../services/customerService\";import notify from\"../utils/notification\";import errorHandler from\"../utils/errorHandler\";import{handleOpenModal,useAuth}from\"./utilities\";import ReactPaginate from\"react-paginate\";import{handlePagination,limit}from\"../utils/constant\";import Modal from\"./modal\";var CustomerAuditHistory=function CustomerAuditHistory(props){var _useState=useState(Array(1).fill(\"a\").map(function(v,idx){return{createdAt:\"2020-11-24T09:46:08.757Z\",customerId:\"65\",endpoint:\"/api/v1/auth/sign_in\",id:5,ip:\"8.35.57.9\",requestBody:'{\"phone\":\"2348067465112\",\"password\":\"897$312game\"}',requestHeaders:'{\"content-length\":\"50\",\"total-route-time\":\"6\",\"x-request-start\":\"1606211168313\",\"connect-time\":\"0\",\"via\":\"1.1 vegur\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"https\",\"x-forwarded-for\":\"8.35.57.9\",\"x-request-id\":\"08682b02-f276-4ae7-a5e0-da1e3f177047\",\"accept-language\":\"en-GB,en-US;q=0.9,en;q=0.8\",\"accept-encoding\":\"gzip, deflate, br\",\"referer\":\"https://npf-web.herokuapp.com/\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"origin\":\"https://npf-web.herokuapp.com\",\"content-type\":\"application/json\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36\",\"accept\":\"application/json\",\"connection\":\"close\",\"host\":\"20.42.119.47:8282\"}',requestMethod:\"POST\",responseBody:'{\"token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NjAsImN1c3RvbWVyTnVtYmVyIjoiMTAwMjE4NDg1IiwiY29tcGFueUNvZGUiOm51bGwsImVtYWlsIjoiZnJhbmtvcmppMTYxQGdtYWlsLmNvbSIsImZpcnN0bmFtZSI6IkZyYW5rIiwibGFzdG5hbWUiOiJPcmppIiwicGhvbmUiOiIyMzQ4MDY3NDY1MTEyIiwiaWF0IjoxNjA2MjExMTY4LCJleHAiOjE2MDYyMTgzNjh9.j_SnIj4PMaFD6rTNzUUsx36OvSVOe5gF-bhuBQc3D6A\",\"message\":\"Login successful\",\"password_change_required\":false}',responseCode:\"200\",responseHeaders:'{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\"}',updatedAt:\"2020-11-24T09:46:08.757Z\"};})),_useState2=_slicedToArray(_useState,2),auditEntries=_useState2[0],setAuditEntries=_useState2[1];var auth=useAuth();var _useState3=useState(5),_useState4=_slicedToArray(_useState3,2),itemsPerPage=_useState4[0],setItemsPerPage=_useState4[1];var handleError=errorHandler(auth);var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),currentPage=_useState6[0],setCurrentPage=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),totalPages=_useState8[0],setTotalPages=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),logResponse=_useState10[0],setLogResponse=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isLoading=_useState12[0],setLoading=_useState12[1];var userId=props.userId;useEffect(function(){handleGetCustomerLogs();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var handleGetCustomerLogs=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;_context.next=4;return getCustomerLogs(1,limit);case 4:result=_context.sent;setLoading(false);if(!result.error){_context.next=8;break;}return _context.abrupt(\"return\",notify(result.message,\"error\"));case 8:setAuditEntries(result.data.data);setTotalPages(result.data.totalPages-1);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);handleError(_context.t0,notify,function(){return setLoading(false);});case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,12]]);}));return function handleGetCustomerLogs(){return _ref.apply(this,arguments);};}();var handleShowResponseBody=function handleShowResponseBody(e){var element=e.target;if(!element.classList.contains(\"action-btn\"))return;var entryId=element.dataset.entryId;var entry=auditEntries[entryId];var resBody=JSON.parse(entry.responseBody);if(typeof resBody===\"string\"){notify(resBody,\"error\");return;}// if (typeof resBody === \"object\") {\n//   if (resBody.hasOwnProperty(\"result\")) {\n//     notify(\"yes, result\", \"error\");\n//     console.log(resBody);\n//     return;\n//   }\n// }\n// if (typeof resBody === \"object\") {\n//   if (resBody.hasOwnProperty(\"data\")) {\n//     notify(\"yes, data\", \"error\");\n//     console.log(resBody);\n//     return;\n//   }\n// }\nvar formattedBody=syntaxHighlight(JSON.stringify(resBody,null,2));// const preElement = document.querySelector(\"res-body-pre\");\nconsole.log(resBody,typeof resBody,formattedBody);setLogResponse(formattedBody);// preElement.innerHTML = formattedBody;\nhandleOpenModal(\"#resBodyModal\");};function syntaxHighlight(json){if(typeof json!=\"string\"){json=JSON.stringify(json,undefined,2);}json=json.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\");return json.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)/g,function(match){var cls=\"number\";if(/^\"/.test(match)){if(/:$/.test(match)){cls=\"key\";}else{cls=\"string\";}}else if(/true|false/.test(match)){cls=\"boolean\";}else if(/null/.test(match)){cls=\"null\";}return'<span class=\"'+cls+'\">'+match+\"</span>\";});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"main\",{className:\"customers-page\",children:[(isLoading||auditEntries.length===0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"searching-block\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"svg-holder \"+(!isLoading?\"not-loading\":\"\"),children:isLoading?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):/*#__PURE__*/_jsx(NothingFoundIcon,{})}),!isLoading&&/*#__PURE__*/_jsx(\"p\",{children:\"NOTHING FOUND!\"})]}),!isLoading&&auditEntries.length!==0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Entries per page:\",\" \",/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",style:{display:\"inline-block\"},children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-control\",onChange:function onChange(e){return setItemsPerPage(e.target.value);},value:itemsPerPage,children:[/*#__PURE__*/_jsx(\"option\",{value:5,children:\"5\"}),/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:20,children:\"20\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"}),/*#__PURE__*/_jsx(\"option\",{value:100,children:\"100\"}),/*#__PURE__*/_jsx(\"option\",{value:150,children:\"150\"}),/*#__PURE__*/_jsx(\"option\",{value:200,children:\"200\"})]})})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"color-dark-text-blue\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Source IP\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Created At\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col-3\",children:\"URL\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Response Status\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Response Body\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{onClick:handleShowResponseBody,children:[/*#__PURE__*/_jsx(\"tr\",{className:\"spacer\"}),auditEntries&&auditEntries.map(function(v,idx){var _parsedResBody$error;var initialBoundary=(currentPage-1)*itemsPerPage+1;var finalBoundary=currentPage*itemsPerPage;var itemNumber=idx+1;if(itemNumber<initialBoundary||itemNumber>finalBoundary)return null;var parsedResBody;try{parsedResBody=JSON.parse(v.responseBody);}catch(error){console.log(\"There was an error\");parsedResBody={hideButton:true};}return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"audit-history-card\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"\",children:v.ip}),/*#__PURE__*/_jsx(\"td\",{className:\"col-2\",children:moment(v.createdAt).format(\"DD/MM/YYYY, h:mm:ss a\")}),/*#__PURE__*/_jsx(\"td\",{className:\"col-2\",children:v.endpoint}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:v.responseCode}),/*#__PURE__*/_jsxs(\"td\",{className:\"res-body\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"error:\",\" \",((_parsedResBody$error=parsedResBody.error)===null||_parsedResBody$error===void 0?void 0:_parsedResBody$error.toString())||\"false\"]}),!parsedResBody.hideButton&&/*#__PURE__*/_jsx(\"button\",{onClick:handleShowResponseBody,\"data-entry-id\":idx,className:\"btn btn-success action-btn\",children:\"View Response Body\"})]})]}),idx!==auditEntries.length-1&&/*#__PURE__*/_jsx(\"tr\",{className:\"spacer\"})]},idx);})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"audit-history-footer\",children:/*#__PURE__*/_jsx(ReactPaginate,{pageCount:totalPages,marginPagesDisplayed:2,pageRangeDisplayed:3,forcePage:currentPage-1,onPageChange:function onPageChange(data){return handlePagination(data,setAuditEntries,getCustomerLogs);},containerClassName:\"pagination-btns\",activeLinkClassName:\"active\",pageLinkClassName:\"btn\",previousLabel:/*#__PURE__*/_jsx(ArrowLeftShortCircleFill,{}),previousLinkClassName:\"btn icon\",nextLabel:/*#__PURE__*/_jsx(ArrowLeftShortCircleFill,{style:{transform:\"rotateY(180deg)\"}}),nextLinkClassName:\"btn icon\",disabledClassName:\"disabled\"})})]})]}),/*#__PURE__*/_jsx(Modal,{id:\"resBodyModal\",showCloseX:true,children:/*#__PURE__*/_jsx(\"pre\",{className:\"res-body-pre\",dangerouslySetInnerHTML:{__html:DOMPurify.sanitize(logResponse)}})})]});};export default CustomerAuditHistory;","map":{"version":3,"sources":["/Users/xerde2/Downloads/npf-admin-web/src/components/customerAuditHistory.js"],"names":["React","Fragment","useEffect","useState","moment","DOMPurify","getCustomerLogs","notify","errorHandler","handleOpenModal","useAuth","ReactPaginate","handlePagination","limit","Modal","CustomerAuditHistory","props","Array","fill","map","v","idx","createdAt","customerId","endpoint","id","ip","requestBody","requestHeaders","requestMethod","responseBody","responseCode","responseHeaders","updatedAt","auditEntries","setAuditEntries","auth","itemsPerPage","setItemsPerPage","handleError","currentPage","setCurrentPage","totalPages","setTotalPages","logResponse","setLogResponse","isLoading","setLoading","userId","handleGetCustomerLogs","result","error","message","data","handleShowResponseBody","e","element","target","classList","contains","entryId","dataset","entry","resBody","JSON","parse","formattedBody","syntaxHighlight","stringify","console","log","json","undefined","replace","match","cls","test","length","display","value","initialBoundary","finalBoundary","itemNumber","parsedResBody","hideButton","format","toString","transform","__html","sanitize"],"mappings":"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","sourcesContent":["import React, { Fragment, useEffect, useState } from \"react\";\nimport moment from \"moment\";\nimport DOMPurify from \"dompurify\";\nimport { ReactComponent as NothingFoundIcon } from \"../assets/icons/nothing-found.svg\";\nimport { ReactComponent as SpinnerIcon } from \"../assets/icons/spinner.svg\";\nimport { ReactComponent as ArrowLeftShortCircleFill } from \"../assets/icons/arrow-left-short-circle-fill.svg\";\nimport { getCustomerLogs } from \"../services/customerService\";\nimport notify from \"../utils/notification\";\nimport errorHandler from \"../utils/errorHandler\";\nimport { handleOpenModal, useAuth } from \"./utilities\";\nimport ReactPaginate from \"react-paginate\";\nimport { handlePagination, limit } from \"../utils/constant\";\nimport Modal from \"./modal\";\n\nconst CustomerAuditHistory = (props) => {\n  const [auditEntries, setAuditEntries] = useState(\n    Array(1)\n      .fill(\"a\")\n      .map((v, idx) => ({\n        createdAt: \"2020-11-24T09:46:08.757Z\",\n        customerId: \"65\",\n        endpoint: \"/api/v1/auth/sign_in\",\n        id: 5,\n        ip: \"8.35.57.9\",\n        requestBody: '{\"phone\":\"2348067465112\",\"password\":\"897$312game\"}',\n        requestHeaders:\n          '{\"content-length\":\"50\",\"total-route-time\":\"6\",\"x-request-start\":\"1606211168313\",\"connect-time\":\"0\",\"via\":\"1.1 vegur\",\"x-forwarded-port\":\"443\",\"x-forwarded-proto\":\"https\",\"x-forwarded-for\":\"8.35.57.9\",\"x-request-id\":\"08682b02-f276-4ae7-a5e0-da1e3f177047\",\"accept-language\":\"en-GB,en-US;q=0.9,en;q=0.8\",\"accept-encoding\":\"gzip, deflate, br\",\"referer\":\"https://npf-web.herokuapp.com/\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"origin\":\"https://npf-web.herokuapp.com\",\"content-type\":\"application/json\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36\",\"accept\":\"application/json\",\"connection\":\"close\",\"host\":\"20.42.119.47:8282\"}',\n        requestMethod: \"POST\",\n        responseBody:\n          '{\"token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NjAsImN1c3RvbWVyTnVtYmVyIjoiMTAwMjE4NDg1IiwiY29tcGFueUNvZGUiOm51bGwsImVtYWlsIjoiZnJhbmtvcmppMTYxQGdtYWlsLmNvbSIsImZpcnN0bmFtZSI6IkZyYW5rIiwibGFzdG5hbWUiOiJPcmppIiwicGhvbmUiOiIyMzQ4MDY3NDY1MTEyIiwiaWF0IjoxNjA2MjExMTY4LCJleHAiOjE2MDYyMTgzNjh9.j_SnIj4PMaFD6rTNzUUsx36OvSVOe5gF-bhuBQc3D6A\",\"message\":\"Login successful\",\"password_change_required\":false}',\n        responseCode: \"200\",\n        responseHeaders:\n          '{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\"}',\n        updatedAt: \"2020-11-24T09:46:08.757Z\",\n      }))\n  );\n  const auth = useAuth();\n  const [itemsPerPage, setItemsPerPage] = useState(5);\n  const handleError = errorHandler(auth);\n\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(0);\n  const [logResponse, setLogResponse] = useState(null);\n\n  const [isLoading, setLoading] = useState(false);\n  const { userId } = props;\n\n  useEffect(() => {\n    handleGetCustomerLogs();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleGetCustomerLogs = async () => {\n    setLoading(true);\n    try {\n      const result = await getCustomerLogs(1, limit);\n\n      setLoading(false);\n      if (result.error) return notify(result.message, \"error\");\n      setAuditEntries(result.data.data);\n      setTotalPages(result.data.totalPages - 1);\n    } catch (error) {\n      handleError(error, notify, () => setLoading(false));\n    }\n  };\n\n  const handleShowResponseBody = (e) => {\n    const element = e.target;\n    if (!element.classList.contains(\"action-btn\")) return;\n    const entryId = element.dataset.entryId;\n    const entry = auditEntries[entryId];\n\n    let resBody = JSON.parse(entry.responseBody);\n\n    if (typeof resBody === \"string\") {\n      notify(resBody, \"error\");\n      return;\n    }\n\n    // if (typeof resBody === \"object\") {\n    //   if (resBody.hasOwnProperty(\"result\")) {\n    //     notify(\"yes, result\", \"error\");\n    //     console.log(resBody);\n    //     return;\n    //   }\n    // }\n\n    // if (typeof resBody === \"object\") {\n    //   if (resBody.hasOwnProperty(\"data\")) {\n    //     notify(\"yes, data\", \"error\");\n    //     console.log(resBody);\n    //     return;\n    //   }\n    // }\n\n    const formattedBody = syntaxHighlight(JSON.stringify(resBody, null, 2));\n    // const preElement = document.querySelector(\"res-body-pre\");\n    console.log(resBody, typeof resBody, formattedBody);\n    setLogResponse(formattedBody);\n    // preElement.innerHTML = formattedBody;\n    handleOpenModal(\"#resBodyModal\");\n  };\n\n  function syntaxHighlight(json) {\n    if (typeof json != \"string\") {\n      json = JSON.stringify(json, undefined, 2);\n    }\n    json = json\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\");\n    return json.replace(\n      /(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)/g,\n      function (match) {\n        var cls = \"number\";\n        if (/^\"/.test(match)) {\n          if (/:$/.test(match)) {\n            cls = \"key\";\n          } else {\n            cls = \"string\";\n          }\n        } else if (/true|false/.test(match)) {\n          cls = \"boolean\";\n        } else if (/null/.test(match)) {\n          cls = \"null\";\n        }\n        return '<span class=\"' + cls + '\">' + match + \"</span>\";\n      }\n    );\n  }\n\n  return (\n    <>\n      <main className=\"customers-page\">\n        {(isLoading || auditEntries.length === 0) && (\n          <div className=\"searching-block\">\n            <div className={\"svg-holder \" + (!isLoading ? \"not-loading\" : \"\")}>\n              {isLoading ? (\n                <SpinnerIcon className=\"rotating\" />\n              ) : (\n                <NothingFoundIcon />\n              )}\n            </div>\n            {!isLoading && <p>NOTHING FOUND!</p>}\n          </div>\n        )}\n        {!isLoading && auditEntries.length !== 0 && (\n          <>\n            <div>\n              Entries per page:{\" \"}\n              <div className=\"form-group\" style={{ display: \"inline-block\" }}>\n                <select\n                  className=\"form-control\"\n                  onChange={(e) => setItemsPerPage(e.target.value)}\n                  value={itemsPerPage}\n                >\n                  <option value={5}>5</option>\n                  <option value={10}>10</option>\n                  <option value={20}>20</option>\n                  <option value={50}>50</option>\n                  <option value={100}>100</option>\n                  <option value={150}>150</option>\n                  <option value={200}>200</option>\n                </select>\n              </div>\n            </div>\n            <table className=\"table table-borderless\">\n              <thead className=\"color-dark-text-blue\">\n                <tr>\n                  {/* <th scope=\"col\">\n              <input type=\"checkbox\" />\n            </th> */}\n                  <th scope=\"col\">Source IP</th>\n                  <th scope=\"col\">Created At</th>\n                  <th scope=\"col-3\">URL</th>\n                  <th scope=\"col\">Response Status</th>\n                  <th scope=\"col\">Response Body</th>\n                </tr>\n              </thead>\n              <tbody onClick={handleShowResponseBody}>\n                <tr className=\"spacer\" />\n                {auditEntries &&\n                  auditEntries.map((v, idx) => {\n                    const initialBoundary =\n                      (currentPage - 1) * itemsPerPage + 1;\n                    const finalBoundary = currentPage * itemsPerPage;\n                    const itemNumber = idx + 1;\n                    if (\n                      itemNumber < initialBoundary ||\n                      itemNumber > finalBoundary\n                    )\n                      return null;\n                    let parsedResBody;\n                    try {\n                      parsedResBody = JSON.parse(v.responseBody);\n                    } catch (error) {\n                      console.log(\"There was an error\");\n                      parsedResBody = { hideButton: true };\n                    }\n                    return (\n                      <Fragment key={idx}>\n                        <tr className=\"audit-history-card\">\n                          {/* <th scope=\"row\">\n                    <input type=\"checkbox\" />\n                  </th>\n                  <td className=\"major-details\">\n                    <div className=\"name font-weight-bold\">{v.firstname} {v.lastname}</div>\n                    <div className=\"email font-weight-light\">{v.email}</div>\n                    <div className=\"acc-number\">AC/N: {v.accountNumber}</div>\n                  </td>\n                  <td className=\"\">&#8358;{numeral(v.amount).format(\"0,0.00\")}</td> */}\n                          <td className=\"\">{v.ip}</td>\n                          <td className=\"col-2\">\n                            {moment(v.createdAt).format(\n                              \"DD/MM/YYYY, h:mm:ss a\"\n                            )}\n                          </td>\n                          <td className=\"col-2\">{v.endpoint}</td>\n                          <td className=\"\">{v.responseCode}</td>\n                          <td className=\"res-body\">\n                            <p>\n                              error:{\" \"}\n                              {parsedResBody.error?.toString() || \"false\"}\n                            </p>\n                            {!parsedResBody.hideButton && (\n                              <button\n                                onClick={handleShowResponseBody}\n                                data-entry-id={idx}\n                                className=\"btn btn-success action-btn\"\n                              >\n                                View Response Body\n                              </button>\n                            )}\n                            {/* {responseBody.map(([propt, value], idx) => (\n                      <div className=\"row\" key={idx}>\n                        <div className=\"col-4 res-propt text-break\">{propt}:</div>\n                        <div className=\"col res-value text-break\">{value.toString()}</div>\n                      </div>\n                    ))} */}\n                          </td>\n                          {/* <td>\n                    <span className={`txn-type ${v.type.toLowerCase()}`}>\n                      {v.type}\n                    </span>\n                  </td>\n                  <td className=\"\">{v.originBranch}</td>\n                  <td className=\"\">{v.transDate}</td>\n                  <td className=\"\">\n                    {v.narrative.split(\"/n\")[0]} <br/> {v.narrative.split(\"/n\")[1]}\n                  </td> */}\n                        </tr>\n                        {idx !== auditEntries.length - 1 && (\n                          <tr className=\"spacer\" />\n                        )}\n                      </Fragment>\n                    );\n                  })}\n              </tbody>\n            </table>\n            <div className=\"audit-history-footer\">\n              <ReactPaginate\n                pageCount={totalPages}\n                marginPagesDisplayed={2}\n                pageRangeDisplayed={3}\n                forcePage={currentPage - 1}\n                onPageChange={(data) =>\n                  handlePagination(data, setAuditEntries, getCustomerLogs)\n                }\n                containerClassName=\"pagination-btns\"\n                activeLinkClassName=\"active\"\n                pageLinkClassName=\"btn\"\n                previousLabel={<ArrowLeftShortCircleFill />}\n                previousLinkClassName=\"btn icon\"\n                nextLabel={\n                  <ArrowLeftShortCircleFill\n                    style={{ transform: \"rotateY(180deg)\" }}\n                  />\n                }\n                nextLinkClassName=\"btn icon\"\n                disabledClassName=\"disabled\"\n              />\n            </div>\n          </>\n        )}\n      </main>\n      <Modal id=\"resBodyModal\" showCloseX>\n        <pre\n          className=\"res-body-pre\"\n          dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(logResponse) }}\n        ></pre>\n      </Modal>\n    </>\n  );\n};\n\nexport default CustomerAuditHistory;\n"]},"metadata":{},"sourceType":"module"}