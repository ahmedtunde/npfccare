{"ast":null,"code":"import _objectSpread from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{Fragment,useEffect,useState}from\"react\";import moment from\"moment\";import{ReactComponent as NothingFoundIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/nothing-found.svg\";import{ReactComponent as SpinnerIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/spinner.svg\";import{ReactComponent as ArrowLeftShortCircleFill}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/arrow-left-short-circle-fill.svg\";import{getCustomerBillings,getBillingStatus}from\"../services/customerService\";import notify from\"../utils/notification\";import errorHandler from\"../utils/errorHandler\";import{handleOpenModal,useAuth}from\"./utilities\";import ReactPaginate from\"react-paginate\";import numeral from\"numeral\";import BillingStatusModal from\"./billingStatusModal\";var CustomerBillingHistory=function CustomerBillingHistory(props){var _useState=useState(Array(0).fill(\"a\").map(function(v,idx){return{amountDue:\"200.00\",rrr:\"000000\",status:\"FAILED\",date:\"2021-04-14T08:54:08.181Z\",description:\"Eko Prepaid Bills\",funds_deduction:\"\"};})),_useState2=_slicedToArray(_useState,2),billingEntries=_useState2[0],setBillingEntries=_useState2[1];var _useState3=useState({rrr:\"\",amountDue:200,chargeFee:100,rrrAmount:100,payerEmail:\"\",payerName:\"\",payerPhone:\"\",description:\"\",currency:\"\",type:\"\",acceptPartPayment:false,message:\"\"}),_useState4=_slicedToArray(_useState3,2),billingStatus=_useState4[0],setBillingStatus=_useState4[1];var auth=useAuth();var _useState5=useState(5),_useState6=_slicedToArray(_useState5,2),itemsPerPage=_useState6[0],setItemsPerPage=_useState6[1];var handleError=errorHandler(auth);var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),currentPage=_useState8[0],setCurrentPage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isLoading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),isStatusFetching=_useState12[0],setStatusFetching=_useState12[1];var userId=props.userId;useEffect(function(){handleGetCustomerBillings();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var handleGetCustomerBillings=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var customer_id,result,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:customer_id=_args.length>0&&_args[0]!==undefined?_args[0]:userId;setLoading(true);_context.prev=2;_context.next=5;return getCustomerBillings(customer_id);case 5:result=_context.sent;setLoading(false);if(!result.error){_context.next=9;break;}return _context.abrupt(\"return\",notify(result.message,\"error\"));case 9:setBillingEntries(result.result);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](2);handleError(_context.t0,notify,function(){return setLoading(false);});case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,12]]);}));return function handleGetCustomerBillings(){return _ref.apply(this,arguments);};}();var handleShowBillingStatus=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var element,rrr,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:element=e.target;if(element.classList.contains(\"action-btn\")){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:rrr=element.dataset.rrr;_context2.prev=4;setStatusFetching(rrr);_context2.next=8;return getBillingStatus(rrr);case 8:result=_context2.sent;setStatusFetching(\"\");if(!result.error){_context2.next=12;break;}return _context2.abrupt(\"return\",notify(result.message,\"error\"));case 12:setBillingStatus(_objectSpread(_objectSpread({},result.result),{},{message:result.message}));handleOpenModal(\"#billingStatusModal\");_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](4);handleError(_context2.t0,notify,function(){return setStatusFetching(\"\");});case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[4,16]]);}));return function handleShowBillingStatus(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[(isLoading||billingEntries.length===0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"searching-block\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"svg-holder \"+(!isLoading?\"not-loading\":\"\"),children:isLoading?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):/*#__PURE__*/_jsx(NothingFoundIcon,{})}),!isLoading&&/*#__PURE__*/_jsx(\"p\",{children:\"NOTHING FOUND!\"})]}),!isLoading&&billingEntries.length!==0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Entries per page:\",\" \",/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",style:{display:\"inline-block\"},children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-control\",onChange:function onChange(e){return setItemsPerPage(e.target.value);},value:itemsPerPage,children:[/*#__PURE__*/_jsx(\"option\",{value:5,children:\"5\"}),/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:20,children:\"20\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"}),/*#__PURE__*/_jsx(\"option\",{value:100,children:\"100\"}),/*#__PURE__*/_jsx(\"option\",{value:150,children:\"150\"}),/*#__PURE__*/_jsx(\"option\",{value:200,children:\"200\"})]})})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-borderless\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"color-dark-text-blue\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col-3\",children:\"RRR\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount Due\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Funds Deduction\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"text-center\",children:\"Actions\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{onClick:handleShowBillingStatus,children:[/*#__PURE__*/_jsx(\"tr\",{className:\"spacer\"}),billingEntries.map(function(v,idx){var initialBoundary=(currentPage-1)*itemsPerPage+1;var finalBoundary=currentPage*itemsPerPage;var itemNumber=idx+1;if(itemNumber<initialBoundary||itemNumber>finalBoundary)return null;return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"billing-history-card\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"\",children:moment(v.date).format(\"MMMM Do, YYYY\")}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:v.description}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:v.rrr}),/*#__PURE__*/_jsxs(\"td\",{className:\"\",children:[\"\\u20A6\",numeral(v.amountDue).format(\"0,0.00\")]}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:v.funds_deduction||\"N/A\"}),/*#__PURE__*/_jsx(\"td\",{className:\"\".concat(v.status===\"SUCCESSFUL\"?\"text-success\":v.status===\"FAILED\"?\"text-danger\":\"\"),children:v.status}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"button\",{\"data-rrr\":v.rrr,className:\"btn btn-success action-btn\",disabled:isStatusFetching,children:isStatusFetching===v.rrr?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):\"View\"})})]}),idx!==billingEntries.length-1&&/*#__PURE__*/_jsx(\"tr\",{className:\"spacer\"})]},idx);})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"audit-history-footer\",children:/*#__PURE__*/_jsx(ReactPaginate,{pageCount:Math.ceil(billingEntries.length/itemsPerPage)||1,marginPagesDisplayed:2,pageRangeDisplayed:3,forcePage:currentPage-1,onPageChange:function onPageChange(selectedItem){return setCurrentPage(selectedItem.selected+1);},containerClassName:\"pagination-btns\",activeLinkClassName:\"active\",pageLinkClassName:\"btn\",previousLabel:/*#__PURE__*/_jsx(ArrowLeftShortCircleFill,{}),previousLinkClassName:\"btn icon\",nextLabel:/*#__PURE__*/_jsx(ArrowLeftShortCircleFill,{style:{transform:\"rotateY(180deg)\"}}),nextLinkClassName:\"btn icon\",disabledClassName:\"disabled\"})})]}),/*#__PURE__*/_jsx(BillingStatusModal,{billingStatus:billingStatus})]});};export default CustomerBillingHistory;","map":{"version":3,"sources":["/Users/xerde2/Downloads/npf-admin-web/src/components/customerBillingHistory.js"],"names":["React","Fragment","useEffect","useState","moment","getCustomerBillings","getBillingStatus","notify","errorHandler","handleOpenModal","useAuth","ReactPaginate","numeral","BillingStatusModal","CustomerBillingHistory","props","Array","fill","map","v","idx","amountDue","rrr","status","date","description","funds_deduction","billingEntries","setBillingEntries","chargeFee","rrrAmount","payerEmail","payerName","payerPhone","currency","type","acceptPartPayment","message","billingStatus","setBillingStatus","auth","itemsPerPage","setItemsPerPage","handleError","currentPage","setCurrentPage","isLoading","setLoading","isStatusFetching","setStatusFetching","userId","handleGetCustomerBillings","customer_id","result","error","handleShowBillingStatus","e","element","target","classList","contains","dataset","length","display","value","initialBoundary","finalBoundary","itemNumber","format","Math","ceil","selectedItem","selected","transform"],"mappings":"yvBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,QAArC,KAAqD,OAArD,CACA,MAAOC,CAAAA,MAAP,KAAmB,QAAnB,C,8WAIA,OACEC,mBADF,CAEEC,gBAFF,KAGO,6BAHP,CAIA,MAAOC,CAAAA,MAAP,KAAmB,uBAAnB,CACA,MAAOC,CAAAA,YAAP,KAAyB,uBAAzB,CACA,OAASC,eAAT,CAA0BC,OAA1B,KAAyC,aAAzC,CACA,MAAOC,CAAAA,aAAP,KAA0B,gBAA1B,CACA,MAAOC,CAAAA,OAAP,KAAoB,SAApB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,sBAA/B,CAEA,GAAMC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,KAAD,CAAW,eACIZ,QAAQ,CAClDa,KAAK,CAAC,CAAD,CAAL,CACGC,IADH,CACQ,GADR,EAEGC,GAFH,CAEO,SAACC,CAAD,CAAIC,GAAJ,QAAa,CAChBC,SAAS,CAAE,QADK,CAEhBC,GAAG,CAAE,QAFW,CAGhBC,MAAM,CAAE,QAHQ,CAIhBC,IAAI,CAAE,0BAJU,CAKhBC,WAAW,CAAE,mBALG,CAMhBC,eAAe,CAAE,EAND,CAAb,EAFP,CADkD,CADZ,wCACjCC,cADiC,eACjBC,iBADiB,8BAaEzB,QAAQ,CAAC,CACjDmB,GAAG,CAAE,EAD4C,CAEjDD,SAAS,CAAE,GAFsC,CAGjDQ,SAAS,CAAE,GAHsC,CAIjDC,SAAS,CAAE,GAJsC,CAKjDC,UAAU,CAAE,EALqC,CAMjDC,SAAS,CAAE,EANsC,CAOjDC,UAAU,CAAE,EAPqC,CAQjDR,WAAW,CAAE,EARoC,CASjDS,QAAQ,CAAE,EATuC,CAUjDC,IAAI,CAAE,EAV2C,CAWjDC,iBAAiB,CAAE,KAX8B,CAYjDC,OAAO,CAAE,EAZwC,CAAD,CAbV,yCAajCC,aAbiC,eAalBC,gBAbkB,eA2BxC,GAAMC,CAAAA,IAAI,CAAG9B,OAAO,EAApB,CA3BwC,eA4BAP,QAAQ,CAAC,CAAD,CA5BR,yCA4BjCsC,YA5BiC,eA4BnBC,eA5BmB,eA6BxC,GAAMC,CAAAA,WAAW,CAAGnC,YAAY,CAACgC,IAAD,CAAhC,CA7BwC,eA+BFrC,QAAQ,CAAC,CAAD,CA/BN,yCA+BjCyC,WA/BiC,eA+BpBC,cA/BoB,8BAiCR1C,QAAQ,CAAC,KAAD,CAjCA,0CAiCjC2C,SAjCiC,gBAiCtBC,UAjCsB,gCAkCM5C,QAAQ,CAAC,EAAD,CAlCd,2CAkCjC6C,gBAlCiC,gBAkCfC,iBAlCe,mBAmChCC,CAAAA,MAnCgC,CAmCrBnC,KAnCqB,CAmChCmC,MAnCgC,CAqCxChD,SAAS,CAAC,UAAM,CACdiD,yBAAyB,GACzB;AACD,CAHQ,CAGN,EAHM,CAAT,CAKA,GAAMA,CAAAA,yBAAyB,0FAAG,0KAAOC,WAAP,+CAAqBF,MAArB,CAChCH,UAAU,CAAC,IAAD,CAAV,CADgC,sCAGT1C,CAAAA,mBAAmB,CAAC+C,WAAD,CAHV,QAGxBC,MAHwB,eAI9BN,UAAU,CAAC,KAAD,CAAV,CAJ8B,IAK1BM,MAAM,CAACC,KALmB,yDAKL/C,MAAM,CAAC8C,MAAM,CAAChB,OAAR,CAAiB,OAAjB,CALD,SAM9BT,iBAAiB,CAACyB,MAAM,CAACA,MAAR,CAAjB,CAN8B,iFAQ9BV,WAAW,aAAQpC,MAAR,CAAgB,iBAAMwC,CAAAA,UAAU,CAAC,KAAD,CAAhB,EAAhB,CAAX,CAR8B,qEAAH,kBAAzBI,CAAAA,yBAAyB,0CAA/B,CAYA,GAAMI,CAAAA,uBAAuB,2FAAG,kBAAOC,CAAP,6IACxBC,OADwB,CACdD,CAAC,CAACE,MADY,IAEzBD,OAAO,CAACE,SAAR,CAAkBC,QAAlB,CAA2B,YAA3B,CAFyB,mEAGxBtC,GAHwB,CAGlBmC,OAAO,CAACI,OAAR,CAAgBvC,GAHE,kBAK5B2B,iBAAiB,CAAC3B,GAAD,CAAjB,CAL4B,uBAMPhB,CAAAA,gBAAgB,CAACgB,GAAD,CANT,QAMtB+B,MANsB,gBAO5BJ,iBAAiB,CAAC,EAAD,CAAjB,CAP4B,IAQxBI,MAAM,CAACC,KARiB,4DAQH/C,MAAM,CAAC8C,MAAM,CAAChB,OAAR,CAAiB,OAAjB,CARH,UAS5BE,gBAAgB,gCACXc,MAAM,CAACA,MADI,MAEdhB,OAAO,CAAEgB,MAAM,CAAChB,OAFF,GAAhB,CAIA5B,eAAe,CAAC,qBAAD,CAAf,CAb4B,qFAe5BkC,WAAW,cAAQpC,MAAR,CAAgB,iBAAM0C,CAAAA,iBAAiB,CAAC,EAAD,CAAvB,EAAhB,CAAX,CAf4B,uEAAH,kBAAvBM,CAAAA,uBAAuB,6CAA7B,CAmBA,mBACE,2BACG,CAACT,SAAS,EAAInB,cAAc,CAACmC,MAAf,GAA0B,CAAxC,gBACC,aAAK,SAAS,CAAC,iBAAf,wBACE,YAAK,SAAS,CAAE,eAAiB,CAAChB,SAAD,CAAa,aAAb,CAA6B,EAA9C,CAAhB,UACGA,SAAS,cACR,KAAC,WAAD,EAAa,SAAS,CAAC,UAAvB,EADQ,cAGR,KAAC,gBAAD,IAJJ,EADF,CAQG,CAACA,SAAD,eAAc,qCARjB,GAFJ,CAaG,CAACA,SAAD,EAAcnB,cAAc,CAACmC,MAAf,GAA0B,CAAxC,eACC,wCACE,2CACoB,GADpB,cAEE,YAAK,SAAS,CAAC,YAAf,CAA4B,KAAK,CAAE,CAAEC,OAAO,CAAE,cAAX,CAAnC,uBACE,gBACE,SAAS,CAAC,cADZ,CAEE,QAAQ,CAAE,kBAACP,CAAD,QAAOd,CAAAA,eAAe,CAACc,CAAC,CAACE,MAAF,CAASM,KAAV,CAAtB,EAFZ,CAGE,KAAK,CAAEvB,YAHT,wBAKE,eAAQ,KAAK,CAAE,CAAf,eALF,cAME,eAAQ,KAAK,CAAE,EAAf,gBANF,cAOE,eAAQ,KAAK,CAAE,EAAf,gBAPF,cAQE,eAAQ,KAAK,CAAE,EAAf,gBARF,cASE,eAAQ,KAAK,CAAE,GAAf,iBATF,cAUE,eAAQ,KAAK,CAAE,GAAf,iBAVF,cAWE,eAAQ,KAAK,CAAE,GAAf,iBAXF,GADF,EAFF,GADF,cAmBE,eAAO,SAAS,CAAC,wBAAjB,wBACE,cAAO,SAAS,CAAC,sBAAjB,uBACE,mCAIE,WAAI,KAAK,CAAC,KAAV,kBAJF,cAKE,WAAI,KAAK,CAAC,KAAV,yBALF,cAME,WAAI,KAAK,CAAC,OAAV,iBANF,cAOE,WAAI,KAAK,CAAC,KAAV,wBAPF,cAQE,WAAI,KAAK,CAAC,KAAV,6BARF,cASE,WAAI,KAAK,CAAC,KAAV,oBATF,cAUE,WAAI,KAAK,CAAC,KAAV,CAAgB,SAAS,CAAC,aAA1B,qBAVF,GADF,EADF,cAiBE,eAAO,OAAO,CAAEc,uBAAhB,wBACE,WAAI,SAAS,CAAC,QAAd,EADF,CAEG5B,cAAc,CAACT,GAAf,CAAmB,SAACC,CAAD,CAAIC,GAAJ,CAAY,CAC9B,GAAM6C,CAAAA,eAAe,CAAG,CAACrB,WAAW,CAAG,CAAf,EAAoBH,YAApB,CAAmC,CAA3D,CACA,GAAMyB,CAAAA,aAAa,CAAGtB,WAAW,CAAGH,YAApC,CACA,GAAM0B,CAAAA,UAAU,CAAG/C,GAAG,CAAG,CAAzB,CACA,GAAI+C,UAAU,CAAGF,eAAb,EAAgCE,UAAU,CAAGD,aAAjD,CACE,MAAO,KAAP,CACF,mBACE,MAAC,QAAD,yBACE,YAAI,SAAS,CAAC,sBAAd,wBAIE,WAAI,SAAS,CAAC,EAAd,UACG9D,MAAM,CAACe,CAAC,CAACK,IAAH,CAAN,CAAe4C,MAAf,CAAsB,eAAtB,CADH,EAJF,cAOE,WAAI,SAAS,CAAC,EAAd,UAAkBjD,CAAC,CAACM,WAApB,EAPF,cAQE,WAAI,SAAS,CAAC,EAAd,UAAkBN,CAAC,CAACG,GAApB,EARF,cASE,YAAI,SAAS,CAAC,EAAd,oBACUV,OAAO,CAACO,CAAC,CAACE,SAAH,CAAP,CAAqB+C,MAArB,CAA4B,QAA5B,CADV,GATF,cAYE,WAAI,SAAS,CAAC,EAAd,UAAkBjD,CAAC,CAACO,eAAF,EAAqB,KAAvC,EAZF,cAaE,WACE,SAAS,WACPP,CAAC,CAACI,MAAF,GAAa,YAAb,CACI,cADJ,CAEIJ,CAAC,CAACI,MAAF,GAAa,QAAb,CACA,aADA,CAEA,EALG,CADX,UASGJ,CAAC,CAACI,MATL,EAbF,cAwBE,WAAI,SAAS,CAAC,aAAd,uBACE,eACE,WAAUJ,CAAC,CAACG,GADd,CAEE,SAAS,CAAC,4BAFZ,CAGE,QAAQ,CAAE0B,gBAHZ,UAKGA,gBAAgB,GAAK7B,CAAC,CAACG,GAAvB,cACC,KAAC,WAAD,EAAa,SAAS,CAAC,UAAvB,EADD,CAGC,MARJ,EADF,EAxBF,GADF,CAuCGF,GAAG,GAAKO,cAAc,CAACmC,MAAf,CAAwB,CAAhC,eACC,WAAI,SAAS,CAAC,QAAd,EAxCJ,GAAe1C,GAAf,CADF,CA6CD,CAnDA,CAFH,GAjBF,GAnBF,cA4FE,YAAK,SAAS,CAAC,sBAAf,uBACE,KAAC,aAAD,EACE,SAAS,CAAEiD,IAAI,CAACC,IAAL,CAAU3C,cAAc,CAACmC,MAAf,CAAwBrB,YAAlC,GAAmD,CADhE,CAEE,oBAAoB,CAAE,CAFxB,CAGE,kBAAkB,CAAE,CAHtB,CAIE,SAAS,CAAEG,WAAW,CAAG,CAJ3B,CAKE,YAAY,CAAE,sBAAC2B,YAAD,QACZ1B,CAAAA,cAAc,CAAC0B,YAAY,CAACC,QAAb,CAAwB,CAAzB,CADF,EALhB,CAQE,kBAAkB,CAAC,iBARrB,CASE,mBAAmB,CAAC,QATtB,CAUE,iBAAiB,CAAC,KAVpB,CAWE,aAAa,cAAE,KAAC,wBAAD,IAXjB,CAYE,qBAAqB,CAAC,UAZxB,CAaE,SAAS,cACP,KAAC,wBAAD,EACE,KAAK,CAAE,CAAEC,SAAS,CAAE,iBAAb,CADT,EAdJ,CAkBE,iBAAiB,CAAC,UAlBpB,CAmBE,iBAAiB,CAAC,UAnBpB,EADF,EA5FF,GAdJ,cAoIE,KAAC,kBAAD,EAAoB,aAAa,CAAEnC,aAAnC,EApIF,GADF,CAwID,CAjND,CAmNA,cAAexB,CAAAA,sBAAf","sourcesContent":["import React, { Fragment, useEffect, useState } from \"react\";\nimport moment from \"moment\";\nimport { ReactComponent as NothingFoundIcon } from \"../assets/icons/nothing-found.svg\";\nimport { ReactComponent as SpinnerIcon } from \"../assets/icons/spinner.svg\";\nimport { ReactComponent as ArrowLeftShortCircleFill } from \"../assets/icons/arrow-left-short-circle-fill.svg\";\nimport {\n  getCustomerBillings,\n  getBillingStatus,\n} from \"../services/customerService\";\nimport notify from \"../utils/notification\";\nimport errorHandler from \"../utils/errorHandler\";\nimport { handleOpenModal, useAuth } from \"./utilities\";\nimport ReactPaginate from \"react-paginate\";\nimport numeral from \"numeral\";\nimport BillingStatusModal from \"./billingStatusModal\";\n\nconst CustomerBillingHistory = (props) => {\n  const [billingEntries, setBillingEntries] = useState(\n    Array(0)\n      .fill(\"a\")\n      .map((v, idx) => ({\n        amountDue: \"200.00\",\n        rrr: \"000000\",\n        status: \"FAILED\",\n        date: \"2021-04-14T08:54:08.181Z\",\n        description: \"Eko Prepaid Bills\",\n        funds_deduction: \"\",\n      }))\n  );\n  const [billingStatus, setBillingStatus] = useState({\n    rrr: \"\",\n    amountDue: 200,\n    chargeFee: 100,\n    rrrAmount: 100,\n    payerEmail: \"\",\n    payerName: \"\",\n    payerPhone: \"\",\n    description: \"\",\n    currency: \"\",\n    type: \"\",\n    acceptPartPayment: false,\n    message: \"\",\n  });\n  const auth = useAuth();\n  const [itemsPerPage, setItemsPerPage] = useState(5);\n  const handleError = errorHandler(auth);\n\n  const [currentPage, setCurrentPage] = useState(1);\n\n  const [isLoading, setLoading] = useState(false);\n  const [isStatusFetching, setStatusFetching] = useState(\"\");\n  const { userId } = props;\n\n  useEffect(() => {\n    handleGetCustomerBillings();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleGetCustomerBillings = async (customer_id = userId) => {\n    setLoading(true);\n    try {\n      const result = await getCustomerBillings(customer_id);\n      setLoading(false);\n      if (result.error) return notify(result.message, \"error\");\n      setBillingEntries(result.result);\n    } catch (error) {\n      handleError(error, notify, () => setLoading(false));\n    }\n  };\n\n  const handleShowBillingStatus = async (e) => {\n    const element = e.target;\n    if (!element.classList.contains(\"action-btn\")) return;\n    const rrr = element.dataset.rrr;\n    try {\n      setStatusFetching(rrr);\n      const result = await getBillingStatus(rrr);\n      setStatusFetching(\"\");\n      if (result.error) return notify(result.message, \"error\");\n      setBillingStatus({\n        ...result.result,\n        message: result.message,\n      });\n      handleOpenModal(\"#billingStatusModal\");\n    } catch (error) {\n      handleError(error, notify, () => setStatusFetching(\"\"));\n    }\n  };\n\n  return (\n    <>\n      {(isLoading || billingEntries.length === 0) && (\n        <div className=\"searching-block\">\n          <div className={\"svg-holder \" + (!isLoading ? \"not-loading\" : \"\")}>\n            {isLoading ? (\n              <SpinnerIcon className=\"rotating\" />\n            ) : (\n              <NothingFoundIcon />\n            )}\n          </div>\n          {!isLoading && <p>NOTHING FOUND!</p>}\n        </div>\n      )}\n      {!isLoading && billingEntries.length !== 0 && (\n        <>\n          <div>\n            Entries per page:{\" \"}\n            <div className=\"form-group\" style={{ display: \"inline-block\" }}>\n              <select\n                className=\"form-control\"\n                onChange={(e) => setItemsPerPage(e.target.value)}\n                value={itemsPerPage}\n              >\n                <option value={5}>5</option>\n                <option value={10}>10</option>\n                <option value={20}>20</option>\n                <option value={50}>50</option>\n                <option value={100}>100</option>\n                <option value={150}>150</option>\n                <option value={200}>200</option>\n              </select>\n            </div>\n          </div>\n          <table className=\"table table-borderless\">\n            <thead className=\"color-dark-text-blue\">\n              <tr>\n                {/* <th scope=\"col\">\n              <input type=\"checkbox\" />\n            </th> */}\n                <th scope=\"col\">Date</th>\n                <th scope=\"col\">Description</th>\n                <th scope=\"col-3\">RRR</th>\n                <th scope=\"col\">Amount Due</th>\n                <th scope=\"col\">Funds Deduction</th>\n                <th scope=\"col\">Status</th>\n                <th scope=\"col\" className=\"text-center\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody onClick={handleShowBillingStatus}>\n              <tr className=\"spacer\" />\n              {billingEntries.map((v, idx) => {\n                const initialBoundary = (currentPage - 1) * itemsPerPage + 1;\n                const finalBoundary = currentPage * itemsPerPage;\n                const itemNumber = idx + 1;\n                if (itemNumber < initialBoundary || itemNumber > finalBoundary)\n                  return null;\n                return (\n                  <Fragment key={idx}>\n                    <tr className=\"billing-history-card\">\n                      {/* <th scope=\"row\">\n                    <input type=\"checkbox\" />\n                  </th> */}\n                      <td className=\"\">\n                        {moment(v.date).format(\"MMMM Do, YYYY\")}\n                      </td>\n                      <td className=\"\">{v.description}</td>\n                      <td className=\"\">{v.rrr}</td>\n                      <td className=\"\">\n                        &#8358;{numeral(v.amountDue).format(\"0,0.00\")}\n                      </td>\n                      <td className=\"\">{v.funds_deduction || \"N/A\"}</td>\n                      <td\n                        className={`${\n                          v.status === \"SUCCESSFUL\"\n                            ? \"text-success\"\n                            : v.status === \"FAILED\"\n                            ? \"text-danger\"\n                            : \"\"\n                        }`}\n                      >\n                        {v.status}\n                      </td>\n                      <td className=\"text-center\">\n                        <button\n                          data-rrr={v.rrr}\n                          className=\"btn btn-success action-btn\"\n                          disabled={isStatusFetching}\n                        >\n                          {isStatusFetching === v.rrr ? (\n                            <SpinnerIcon className=\"rotating\" />\n                          ) : (\n                            \"View\"\n                          )}\n                        </button>\n                      </td>\n                    </tr>\n                    {idx !== billingEntries.length - 1 && (\n                      <tr className=\"spacer\" />\n                    )}\n                  </Fragment>\n                );\n              })}\n            </tbody>\n          </table>\n          <div className=\"audit-history-footer\">\n            <ReactPaginate\n              pageCount={Math.ceil(billingEntries.length / itemsPerPage) || 1}\n              marginPagesDisplayed={2}\n              pageRangeDisplayed={3}\n              forcePage={currentPage - 1}\n              onPageChange={(selectedItem) =>\n                setCurrentPage(selectedItem.selected + 1)\n              }\n              containerClassName=\"pagination-btns\"\n              activeLinkClassName=\"active\"\n              pageLinkClassName=\"btn\"\n              previousLabel={<ArrowLeftShortCircleFill />}\n              previousLinkClassName=\"btn icon\"\n              nextLabel={\n                <ArrowLeftShortCircleFill\n                  style={{ transform: \"rotateY(180deg)\" }}\n                />\n              }\n              nextLinkClassName=\"btn icon\"\n              disabledClassName=\"disabled\"\n            />\n          </div>\n        </>\n      )}\n\n      <BillingStatusModal billingStatus={billingStatus} />\n    </>\n  );\n};\n\nexport default CustomerBillingHistory;\n"]},"metadata":{},"sourceType":"module"}