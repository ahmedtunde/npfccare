{"ast":null,"code":"import _objectSpread from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{Fragment,useState,useEffect,useCallback}from\"react\";import{Link}from\"react-router-dom\";import moment from\"moment\";import{useHistory}from\"react-router-dom\";import jwt_decode from\"jwt-decode\";import face from\"../assets/img/placeholder-img.png\";import placeholderImg from\"../assets/img/placeholder-img.png\";import{ReactComponent as ArrowLeftShortCircleFill}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/arrow-left-short-circle-fill.svg\";import{ReactComponent as SpinnerIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/spinner.svg\";import{ReactComponent as ExportIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/export.svg\";import{ReactComponent as NothingFoundIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../assets/icons/nothing-found.svg\";import{getBillingStatus,getExportTransactionData,getFailedBillings}from\"../services/customerService\";import DatePicker from\"react-datepicker\";import errorHandler,{validateToken}from\"../utils/errorHandler\";import notify from\"../utils/notification\";import{handleOpenModal,handleHideModal,useAuth}from\"./utilities\";import ReactPaginate from\"react-paginate\";import numeral from\"numeral\";import BillingStatusModal from\"./billingStatusModal\";import Modal from\"./modal\";import{getAccessToken}from\"../utils/localStorageService\";var FailedBillings=function FailedBillings(props){var auth=useAuth();// useCallback ensures that handle error function isn't recreated on every render\nvar handleError=useCallback(function(errorObject,notify,cb){return errorHandler(auth)(errorObject,notify,cb);},[auth]);var _useState=useState(function(){return Array(0).fill(\"\").map(function(v,idx){return{user:54,amountDue:\"100.00\",rrr:\"\",status:\"INCOMPLETE\",date:\"2021-04-21T09:22:39.830Z\",responseObject:null,description:\"\",funds_deduction:\"\",CustomerUser:{locked:false,CustomerInfos:[{id:54,firstname:\"\",lastname:\"\",email:\"\",phone:\"\"}]}};});}),_useState2=_slicedToArray(_useState,2),billingEntries=_useState2[0],setBillingEntries=_useState2[1];var _useState3=useState({rrr:\"\",amountDue:0,chargeFee:0,rrrAmount:0,payerEmail:\"\",payerName:\"\",payerPhone:\"\",description:\"\",currency:\"\",type:\"\",acceptPartPayment:false,message:\"\"}),_useState4=_slicedToArray(_useState3,2),billingStatus=_useState4[0],setBillingStatus=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),isStatusFetching=_useState6[0],setStatusFetching=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),currentPage=_useState8[0],setCurrentPage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isLoading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(5),_useState12=_slicedToArray(_useState11,2),itemsPerPage=_useState12[0],setItemsPerPage=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isDataExporting=_useState14[0],setDataExporting=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),selectedCustomers=_useState16[0],setSelectedCustomers=_useState16[1];var _useState17=useState({search:\"\",start_date:\"\",end_date:\"\"}),_useState18=_slicedToArray(_useState17,2),values=_useState18[0],setValues=_useState18[1];var token=getAccessToken();var history=useHistory();useEffect(function(){validateToken(token,history,jwt_decode,auth,notify);},[auth,history,token]);// useCallback ensures that handle error function isn't recreated on every render\nvar fetchFailedBillings=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(method,param){var _result$result,result,tempBillingEntry;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;_context.next=4;return getFailedBillings();case 4:result=_context.sent;setLoading(false);if(!result.error){_context.next=8;break;}return _context.abrupt(\"return\",notify(result.message,\"error\"));case 8:tempBillingEntry=result===null||result===void 0?void 0:(_result$result=result.result)===null||_result$result===void 0?void 0:_result$result.filter(function(_ref2){var user=_ref2.user;return user!==null;});setBillingEntries(tempBillingEntry!==null&&tempBillingEntry!==void 0?tempBillingEntry:[]);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);handleError(_context.t0,notify,function(){return setLoading(false);});case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,12]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}(),[handleError]);useEffect(function(){fetchFailedBillings();},[fetchFailedBillings]);var handleShowBillingStatus=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var element,rrr,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:element=e.target;if(element.classList.contains(\"action-btn\")){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:rrr=element.dataset.rrr;_context2.prev=4;setStatusFetching(rrr);_context2.next=8;return getBillingStatus(rrr);case 8:result=_context2.sent;setStatusFetching(\"\");if(!result.error){_context2.next=12;break;}return _context2.abrupt(\"return\",notify(result.message,\"error\"));case 12:setBillingStatus(_objectSpread(_objectSpread({},result.result),{},{message:result.message}));handleOpenModal(\"#billingStatusModal\");_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](4);handleError(_context2.t0,notify,function(){return setStatusFetching(\"\");});case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[4,16]]);}));return function handleShowBillingStatus(_x3){return _ref3.apply(this,arguments);};}();var handleExportData=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var customer_ids,start_date,end_date,requestTime,result,url,link;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setDataExporting(true);handleHideModal(\"#exportCustomersDataModal\");_context3.prev=2;customer_ids=selectedCustomers.includes(\"all\")?[]:selectedCustomers;start_date=values.start_date?values.start_date.toISOString():\"\";end_date=values.end_date?values.end_date.toISOString():\"\";requestTime=moment().format(\"DD-MM-YY\");// fetch result\n_context3.next=9;return getExportTransactionData({customer_ids:customer_ids,start_date:start_date,end_date:end_date});case 9:result=_context3.sent;setDataExporting(false);// handle download\nurl=window.URL.createObjectURL(result);link=document.createElement(\"a\");link.href=url;link.setAttribute(\"download\",\"Transactions \".concat(requestTime,\".xlsx\"));//or any other extension\ndocument.body.appendChild(link);link.click();setTimeout(function(){document.body.removeChild(link);window.URL.revokeObjectURL(url);setValues(function(prev){return _objectSpread(_objectSpread({},prev),{},{start_date:null,end_date:null});});},500);_context3.next=23;break;case 20:_context3.prev=20;_context3.t0=_context3[\"catch\"](2);handleError(_context3.t0,notify,function(){return setDataExporting(false);});case 23:case\"end\":return _context3.stop();}}},_callee3,null,[[2,20]]);}));return function handleExportData(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"header\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h1\",{children:\"Failed Billing History\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"small-admin-details\",children:[/*#__PURE__*/_jsx(\"img\",{src:face,alt:\"\"}),\"NPF Admin\",/*#__PURE__*/_jsx(\"i\",{className:\"arrow down\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"some-container\",children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(e){return handleOpenModal(\"#exportCustomersDataModal\");},id:\"exportCustomersData\",className:\"btn export-data-btn d-block \".concat(isDataExporting?\"loading disabled\":\"\"),children:isDataExporting?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ExportIcon,{}),\" Export Data\"]})})})]})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"customers-page\",children:[(isLoading||billingEntries.length===0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"searching-block\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"svg-holder \"+(!isLoading?\"not-loading\":\"\"),children:isLoading?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):/*#__PURE__*/_jsx(NothingFoundIcon,{})}),!isLoading&&/*#__PURE__*/_jsx(\"p\",{children:\"NOTHING FOUND!\"})]}),!isLoading&&billingEntries.length!==0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"color-dark-text-blue\",children:[\"Customers per page:\",\" \",/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",style:{display:\"inline-block\"},children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-control\",onChange:function onChange(e){setItemsPerPage(e.target.value);setCurrentPage(1);},value:itemsPerPage,children:[/*#__PURE__*/_jsx(\"option\",{value:5,children:\"5\"}),/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:20,children:\"20\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"}),/*#__PURE__*/_jsx(\"option\",{value:100,children:\"100\"}),/*#__PURE__*/_jsx(\"option\",{value:150,children:\"150\"}),/*#__PURE__*/_jsx(\"option\",{value:200,children:\"200\"})]})})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-borderless table-hover\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"color-dark-text-blue\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Customer\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col-3\",children:\"RRR\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Amount Due\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Funds Deduction\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"text-center\",children:\"Actions\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{onClick:handleShowBillingStatus,children:[/*#__PURE__*/_jsx(\"tr\",{className:\"spacer\"}),billingEntries.map(function(entry,idx){var initialBoundary=(currentPage-1)*itemsPerPage+1;var finalBoundary=currentPage*itemsPerPage;var itemNumber=idx+1;if(itemNumber<initialBoundary||itemNumber>finalBoundary)return null;if(entry.user===null)return null;var _entry$CustomerUser$C=_slicedToArray(entry.CustomerUser.CustomerInfos,1),CustomerInfo=_entry$CustomerUser$C[0];return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"customer-card\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"major-details\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"customer-img\",children:/*#__PURE__*/_jsx(\"img\",{src:entry.photo_location||placeholderImg,className:\"\",alt:\"\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"name font-weight-bold\",children:[CustomerInfo===null||CustomerInfo===void 0?void 0:CustomerInfo.firstname,\" \",CustomerInfo===null||CustomerInfo===void 0?void 0:CustomerInfo.lastname]}),/*#__PURE__*/_jsx(\"div\",{className:\"email font-weight-light\",children:CustomerInfo===null||CustomerInfo===void 0?void 0:CustomerInfo.email}),/*#__PURE__*/_jsx(\"div\",{className:\"acc-number\",children:/*#__PURE__*/_jsx(Link,{to:\"/pages/customers/\".concat(entry.user),children:\"View Customer\"})})]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:moment(entry.date).format(\"MMMM Do, YYYY\")}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:entry.description}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:entry.rrr}),/*#__PURE__*/_jsxs(\"td\",{className:\"\",children:[\"\\u20A6\",numeral(entry.amountDue).format(\"0,0.00\")]}),/*#__PURE__*/_jsx(\"td\",{className:\"\",children:entry.funds_deduction||\"N/A\"}),/*#__PURE__*/_jsx(\"td\",{className:\"\".concat(entry.status===\"SUCCESSFUL\"?\"text-success\":entry.status===\"FAILED\"?\"text-danger\":\"\"),children:entry.status}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"button\",{\"data-rrr\":entry.rrr,className:\"btn btn-success action-btn\",disabled:isStatusFetching,children:isStatusFetching===entry.rrr?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):\"View\"})})]}),idx!==billingEntries.length-1&&/*#__PURE__*/_jsx(\"tr\",{className:\"spacer\"})]},\"\".concat(entry.user,\" + \").concat(idx));})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"audit-history-footer\",children:/*#__PURE__*/_jsx(ReactPaginate,{pageCount:Math.ceil(billingEntries.length/itemsPerPage)||1,marginPagesDisplayed:2,pageRangeDisplayed:3,forcePage:currentPage-1,onPageChange:function onPageChange(selectedItem){return setCurrentPage(selectedItem.selected+1);},containerClassName:\"pagination-btns\",activeLinkClassName:\"active\",pageLinkClassName:\"btn\",previousLabel:/*#__PURE__*/_jsx(ArrowLeftShortCircleFill,{}),previousLinkClassName:\"btn icon\",nextLabel:/*#__PURE__*/_jsx(ArrowLeftShortCircleFill,{style:{transform:\"rotateY(180deg)\"}}),nextLinkClassName:\"btn icon\",disabledClassName:\"disabled\"})}),\" \"]})]}),/*#__PURE__*/_jsx(Modal,{id:\"exportCustomersDataModal\",showCloseX:true,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"modal-title color-dark-text-blue\",id:\"exportCustomersDataModalLabel\",children:\"Export Transactions Data\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"color-dark-text-blue\",children:\"Select date range\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-range-container row my-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-6\",children:/*#__PURE__*/_jsx(DatePicker,{selected:values.start_date,value:values.start_date,onChange:function onChange(date){return setValues(function(prev){return _objectSpread(_objectSpread({},prev),{},{start_date:date});});},name:\"start_date\",dateFormat:\"dd/MM/yyyy\",placeholderText:\"Start Date\",className:\"start_date form-control\",peekNextMonth:true,showMonthDropdown:true,showYearDropdown:true,dropdownMode:\"select\",locale:\"en-GB\",isClearable:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-6\",children:/*#__PURE__*/_jsx(DatePicker,{selected:values.end_date,value:values.end_date,onChange:function onChange(date){return setValues(function(prev){return _objectSpread(_objectSpread({},prev),{},{end_date:date});});},name:\"end_date\",dateFormat:\"dd/MM/yyyy\",placeholderText:\"End date\",className:\"end_date form-control\"// minDate={values.start_date}\n,peekNextMonth:true,showMonthDropdown:true,showYearDropdown:true,dropdownMode:\"select\",locale:\"en-GB\",isClearable:true})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:handleExportData,disabled:!values.start_date||!values.end_date||values.start_date&&values.end_date&&moment(values.start_date).isAfter(values.end_date),children:\"Continue\"}),/*#__PURE__*/_jsx(\"small\",{className:\"text-danger d-block\",children:values.start_date&&values.end_date&&moment(values.start_date).isAfter(values.end_date)&&\"Please select an end date that comes after the start date.\"})]})]})]})}),/*#__PURE__*/_jsx(BillingStatusModal,{billingStatus:billingStatus})]});};export default FailedBillings;","map":{"version":3,"sources":["/Users/xerde2/Downloads/npf-admin-web/src/components/failedBillings.js"],"names":["React","Fragment","useState","useEffect","useCallback","Link","moment","useHistory","jwt_decode","face","placeholderImg","getBillingStatus","getExportTransactionData","getFailedBillings","DatePicker","errorHandler","validateToken","notify","handleOpenModal","handleHideModal","useAuth","ReactPaginate","numeral","BillingStatusModal","Modal","getAccessToken","FailedBillings","props","auth","handleError","errorObject","cb","Array","fill","map","v","idx","user","amountDue","rrr","status","date","responseObject","description","funds_deduction","CustomerUser","locked","CustomerInfos","id","firstname","lastname","email","phone","billingEntries","setBillingEntries","chargeFee","rrrAmount","payerEmail","payerName","payerPhone","currency","type","acceptPartPayment","message","billingStatus","setBillingStatus","isStatusFetching","setStatusFetching","currentPage","setCurrentPage","isLoading","setLoading","itemsPerPage","setItemsPerPage","isDataExporting","setDataExporting","selectedCustomers","setSelectedCustomers","search","start_date","end_date","values","setValues","token","history","fetchFailedBillings","method","param","result","error","tempBillingEntry","filter","handleShowBillingStatus","e","element","target","classList","contains","dataset","handleExportData","customer_ids","includes","toISOString","requestTime","format","url","window","URL","createObjectURL","link","document","createElement","href","setAttribute","body","appendChild","click","setTimeout","removeChild","revokeObjectURL","prev","length","display","value","entry","initialBoundary","finalBoundary","itemNumber","CustomerInfo","photo_location","Math","ceil","selectedItem","selected","transform","isAfter"],"mappings":"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","sourcesContent":["import React, { Fragment, useState, useEffect, useCallback } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport moment from \"moment\";\nimport { useHistory } from \"react-router-dom\";\nimport jwt_decode from \"jwt-decode\";\nimport face from \"../assets/img/placeholder-img.png\";\nimport placeholderImg from \"../assets/img/placeholder-img.png\";\nimport { ReactComponent as ArrowLeftShortCircleFill } from \"../assets/icons/arrow-left-short-circle-fill.svg\";\nimport { ReactComponent as SpinnerIcon } from \"../assets/icons/spinner.svg\";\nimport { ReactComponent as ExportIcon } from \"../assets/icons/export.svg\";\nimport { ReactComponent as NothingFoundIcon } from \"../assets/icons/nothing-found.svg\";\nimport {\n  getBillingStatus,\n  getExportTransactionData,\n  getFailedBillings,\n} from \"../services/customerService\";\nimport DatePicker from \"react-datepicker\";\nimport errorHandler, { validateToken } from \"../utils/errorHandler\";\nimport notify from \"../utils/notification\";\nimport { handleOpenModal, handleHideModal, useAuth } from \"./utilities\";\nimport ReactPaginate from \"react-paginate\";\nimport numeral from \"numeral\";\nimport BillingStatusModal from \"./billingStatusModal\";\nimport Modal from \"./modal\";\nimport { getAccessToken } from \"../utils/localStorageService\";\n\nconst FailedBillings = (props) => {\n  const auth = useAuth();\n  // useCallback ensures that handle error function isn't recreated on every render\n  const handleError = useCallback(\n    (errorObject, notify, cb) => errorHandler(auth)(errorObject, notify, cb),\n    [auth]\n  );\n\n  const [billingEntries, setBillingEntries] = useState(() =>\n    Array(0)\n      .fill(\"\")\n      .map((v, idx) => ({\n        user: 54,\n        amountDue: \"100.00\",\n        rrr: \"\",\n        status: \"INCOMPLETE\",\n        date: \"2021-04-21T09:22:39.830Z\",\n        responseObject: null,\n        description: \"\",\n        funds_deduction: \"\",\n        CustomerUser: {\n          locked: false,\n          CustomerInfos: [\n            {\n              id: 54,\n              firstname: \"\",\n              lastname: \"\",\n              email: \"\",\n              phone: \"\",\n            },\n          ],\n        },\n      }))\n  );\n  const [billingStatus, setBillingStatus] = useState({\n    rrr: \"\",\n    amountDue: 0,\n    chargeFee: 0,\n    rrrAmount: 0,\n    payerEmail: \"\",\n    payerName: \"\",\n    payerPhone: \"\",\n    description: \"\",\n    currency: \"\",\n    type: \"\",\n    acceptPartPayment: false,\n    message: \"\",\n  });\n  const [isStatusFetching, setStatusFetching] = useState(\"\");\n  const [currentPage, setCurrentPage] = useState(1);\n  const [isLoading, setLoading] = useState(false);\n  const [itemsPerPage, setItemsPerPage] = useState(5);\n  const [isDataExporting, setDataExporting] = useState(false);\n  const [selectedCustomers, setSelectedCustomers] = useState([]);\n  const [values, setValues] = useState({\n    search: \"\",\n    start_date: \"\",\n    end_date: \"\",\n  });\n\n  const token = getAccessToken();\n  const history = useHistory();\n\n  useEffect(() => {\n    validateToken(token, history, jwt_decode, auth, notify);\n  }, [auth, history, token]);\n\n  // useCallback ensures that handle error function isn't recreated on every render\n  const fetchFailedBillings = useCallback(\n    async (method, param) => {\n      setLoading(true);\n      try {\n        const result = await getFailedBillings();\n        setLoading(false);\n        if (result.error) return notify(result.message, \"error\");\n        const tempBillingEntry = result?.result?.filter(\n          ({ user }) => user !== null\n        );\n        setBillingEntries(tempBillingEntry ?? []);\n      } catch (error) {\n        handleError(error, notify, () => setLoading(false));\n      }\n    },\n    [handleError]\n  );\n\n  useEffect(() => {\n    fetchFailedBillings();\n  }, [fetchFailedBillings]);\n\n  const handleShowBillingStatus = async (e) => {\n    const element = e.target;\n    if (!element.classList.contains(\"action-btn\")) return;\n    const rrr = element.dataset.rrr;\n    try {\n      setStatusFetching(rrr);\n      const result = await getBillingStatus(rrr);\n      setStatusFetching(\"\");\n      if (result.error) return notify(result.message, \"error\");\n      setBillingStatus({\n        ...result.result,\n        message: result.message,\n      });\n      handleOpenModal(\"#billingStatusModal\");\n    } catch (error) {\n      handleError(error, notify, () => setStatusFetching(\"\"));\n    }\n  };\n\n  const handleExportData = async () => {\n    setDataExporting(true);\n    handleHideModal(\"#exportCustomersDataModal\");\n    try {\n      const customer_ids = selectedCustomers.includes(\"all\")\n        ? []\n        : selectedCustomers;\n      const start_date = values.start_date\n        ? values.start_date.toISOString()\n        : \"\";\n      const end_date = values.end_date ? values.end_date.toISOString() : \"\";\n      const requestTime = moment().format(\"DD-MM-YY\");\n      // fetch result\n      const result = await getExportTransactionData({\n        customer_ids,\n        start_date,\n        end_date,\n      });\n      setDataExporting(false);\n      // handle download\n      const url = window.URL.createObjectURL(result);\n      const link = document.createElement(\"a\");\n      link.href = url;\n      link.setAttribute(\"download\", `Transactions ${requestTime}.xlsx`); //or any other extension\n      document.body.appendChild(link);\n      link.click();\n      setTimeout(() => {\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(url);\n        setValues((prev) => ({\n          ...prev,\n          start_date: null,\n          end_date: null,\n        }));\n      }, 500);\n    } catch (error) {\n      handleError(error, notify, () => setDataExporting(false));\n    }\n  };\n\n  return (\n    <>\n      <header>\n        <div>\n          <h1>Failed Billing History</h1>\n        </div>\n        <div>\n          <div className=\"small-admin-details\">\n            <img src={face} alt=\"\" />\n            NPF Admin\n            <i className=\"arrow down\"></i>\n          </div>\n          <div className=\"some-container\">\n            <button\n              onClick={(e) => handleOpenModal(\"#exportCustomersDataModal\")}\n              id=\"exportCustomersData\"\n              className={`btn export-data-btn d-block ${\n                isDataExporting ? \"loading disabled\" : \"\"\n              }`}\n            >\n              {isDataExporting ? (\n                <SpinnerIcon className=\"rotating\" />\n              ) : (\n                <>\n                  <ExportIcon /> Export Data\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </header>\n      <main className=\"customers-page\">\n        {(isLoading || billingEntries.length === 0) && (\n          <div className=\"searching-block\">\n            <div className={\"svg-holder \" + (!isLoading ? \"not-loading\" : \"\")}>\n              {isLoading ? (\n                <SpinnerIcon className=\"rotating\" />\n              ) : (\n                <NothingFoundIcon />\n              )}\n            </div>\n            {!isLoading && <p>NOTHING FOUND!</p>}\n          </div>\n        )}\n        {!isLoading && billingEntries.length !== 0 && (\n          <>\n            <div className=\"color-dark-text-blue\">\n              Customers per page:{\" \"}\n              <div className=\"form-group\" style={{ display: \"inline-block\" }}>\n                <select\n                  className=\"form-control\"\n                  onChange={(e) => {\n                    setItemsPerPage(e.target.value);\n                    setCurrentPage(1);\n                  }}\n                  value={itemsPerPage}\n                >\n                  <option value={5}>5</option>\n                  <option value={10}>10</option>\n                  <option value={20}>20</option>\n                  <option value={50}>50</option>\n                  <option value={100}>100</option>\n                  <option value={150}>150</option>\n                  <option value={200}>200</option>\n                </select>\n              </div>\n            </div>\n            <table className=\"table table-borderless table-hover\">\n              <thead className=\"color-dark-text-blue\">\n                <tr>\n                  <th scope=\"col\">Customer</th>\n                  <th scope=\"col\">Date</th>\n                  <th scope=\"col\">Description</th>\n                  <th scope=\"col-3\">RRR</th>\n                  <th scope=\"col\">Amount Due</th>\n                  <th scope=\"col\">Funds Deduction</th>\n                  <th scope=\"col\">Status</th>\n                  <th scope=\"col\" className=\"text-center\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n              <tbody onClick={handleShowBillingStatus}>\n                <tr className=\"spacer\" />\n                {billingEntries.map((entry, idx) => {\n                  const initialBoundary = (currentPage - 1) * itemsPerPage + 1;\n                  const finalBoundary = currentPage * itemsPerPage;\n                  const itemNumber = idx + 1;\n                  if (\n                    itemNumber < initialBoundary ||\n                    itemNumber > finalBoundary\n                  )\n                    return null;\n                  if (entry.user === null) return null;\n\n                  const {\n                    CustomerUser: {\n                      CustomerInfos: [CustomerInfo],\n                    },\n                  } = entry;\n\n                  return (\n                    <Fragment key={`${entry.user} + ${idx}`}>\n                      <tr className=\"customer-card\">\n                        <td className=\"major-details\">\n                          <div className=\"row\">\n                            <div className=\"customer-img\">\n                              <img\n                                src={entry.photo_location || placeholderImg}\n                                className=\"\"\n                                alt=\"\"\n                              />\n                            </div>\n                            <div className=\"col\">\n                              <div className=\"name font-weight-bold\">\n                                {CustomerInfo?.firstname}{\" \"}\n                                {CustomerInfo?.lastname}\n                              </div>\n                              <div className=\"email font-weight-light\">\n                                {CustomerInfo?.email}\n                              </div>\n                              <div className=\"acc-number\">\n                                <Link to={`/pages/customers/${entry.user}`}>\n                                  View Customer\n                                </Link>\n                              </div>\n                            </div>\n                          </div>\n                        </td>\n                        <td className=\"\">\n                          {moment(entry.date).format(\"MMMM Do, YYYY\")}\n                        </td>\n                        <td className=\"\">{entry.description}</td>\n                        <td className=\"\">{entry.rrr}</td>\n                        <td className=\"\">\n                          &#8358;{numeral(entry.amountDue).format(\"0,0.00\")}\n                        </td>\n                        <td className=\"\">{entry.funds_deduction || \"N/A\"}</td>\n                        <td\n                          className={`${\n                            entry.status === \"SUCCESSFUL\"\n                              ? \"text-success\"\n                              : entry.status === \"FAILED\"\n                              ? \"text-danger\"\n                              : \"\"\n                          }`}\n                        >\n                          {entry.status}\n                        </td>\n                        <td className=\"text-center\">\n                          <button\n                            data-rrr={entry.rrr}\n                            className=\"btn btn-success action-btn\"\n                            disabled={isStatusFetching}\n                          >\n                            {isStatusFetching === entry.rrr ? (\n                              <SpinnerIcon className=\"rotating\" />\n                            ) : (\n                              \"View\"\n                            )}\n                          </button>\n                        </td>\n                      </tr>\n                      {idx !== billingEntries.length - 1 && (\n                        <tr className=\"spacer\" />\n                      )}\n                    </Fragment>\n                  );\n                })}\n              </tbody>\n            </table>\n            <div className=\"audit-history-footer\">\n              <ReactPaginate\n                pageCount={Math.ceil(billingEntries.length / itemsPerPage) || 1}\n                marginPagesDisplayed={2}\n                pageRangeDisplayed={3}\n                forcePage={currentPage - 1}\n                onPageChange={(selectedItem) =>\n                  setCurrentPage(selectedItem.selected + 1)\n                }\n                containerClassName=\"pagination-btns\"\n                activeLinkClassName=\"active\"\n                pageLinkClassName=\"btn\"\n                previousLabel={<ArrowLeftShortCircleFill />}\n                previousLinkClassName=\"btn icon\"\n                nextLabel={\n                  <ArrowLeftShortCircleFill\n                    style={{ transform: \"rotateY(180deg)\" }}\n                  />\n                }\n                nextLinkClassName=\"btn icon\"\n                disabledClassName=\"disabled\"\n              />\n            </div>{\" \"}\n          </>\n        )}\n      </main>\n      <Modal id=\"exportCustomersDataModal\" showCloseX>\n        <div className=\"modal-body\">\n          <h5\n            className=\"modal-title color-dark-text-blue\"\n            id={`exportCustomersDataModalLabel`}\n          >\n            Export Transactions Data\n          </h5>\n          <div className=\"\">\n            <p className=\"color-dark-text-blue\">Select date range</p>\n            <div className=\"date-range-container row my-5\">\n              <div className=\"col-6\">\n                <DatePicker\n                  selected={values.start_date}\n                  value={values.start_date}\n                  onChange={(date) =>\n                    setValues((prev) => ({\n                      ...prev,\n                      start_date: date,\n                    }))\n                  }\n                  name=\"start_date\"\n                  dateFormat=\"dd/MM/yyyy\"\n                  placeholderText=\"Start Date\"\n                  className=\"start_date form-control\"\n                  peekNextMonth\n                  showMonthDropdown\n                  showYearDropdown\n                  dropdownMode=\"select\"\n                  locale=\"en-GB\"\n                  isClearable\n                />\n              </div>\n\n              <div className=\"col-6\">\n                <DatePicker\n                  selected={values.end_date}\n                  value={values.end_date}\n                  onChange={(date) =>\n                    setValues((prev) => ({\n                      ...prev,\n                      end_date: date,\n                    }))\n                  }\n                  name=\"end_date\"\n                  dateFormat=\"dd/MM/yyyy\"\n                  placeholderText=\"End date\"\n                  className=\"end_date form-control\"\n                  // minDate={values.start_date}\n                  peekNextMonth\n                  showMonthDropdown\n                  showYearDropdown\n                  dropdownMode=\"select\"\n                  locale=\"en-GB\"\n                  isClearable\n                />\n              </div>\n            </div>\n            <div className=\"mt-4\">\n              <button\n                type=\"button\"\n                className=\"btn btn-primary\"\n                onClick={handleExportData}\n                disabled={\n                  !values.start_date ||\n                  !values.end_date ||\n                  (values.start_date &&\n                    values.end_date &&\n                    moment(values.start_date).isAfter(values.end_date))\n                }\n              >\n                Continue\n              </button>\n              <small className=\"text-danger d-block\">\n                {values.start_date &&\n                  values.end_date &&\n                  moment(values.start_date).isAfter(values.end_date) &&\n                  \"Please select an end date that comes after the start date.\"}\n              </small>\n            </div>\n          </div>\n        </div>\n      </Modal>\n      <BillingStatusModal billingStatus={billingStatus} />\n    </>\n  );\n};\n\nexport default FailedBillings;\n"]},"metadata":{},"sourceType":"module"}