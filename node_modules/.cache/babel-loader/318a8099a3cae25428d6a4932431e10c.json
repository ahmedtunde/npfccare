{"ast":null,"code":"import _regeneratorRuntime from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/xerde2/Downloads/npf-admin-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";// Checkboxes beside customers are commented out to until feature to export data of selected customers is needed\n// -----------------------------------------------\nimport React,{Fragment,useState,useEffect,useCallback,useMemo}from\"react\";import{useHistory}from\"react-router-dom\";import face from\"../../../assets/img/placeholder-img.png\";import{ReactComponent as TimesIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../../../assets/icons/times.svg\";import{ReactComponent as SpinnerIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../../../assets/icons/spinner.svg\";import{ReactComponent as NothingFoundIcon}from\"@svgr/webpack?-svgo,+titleProp,+ref!../../../assets/icons/nothing-found.svg\";import errorHandler from\"../../../utils/errorHandler\";import notify from\"../../../utils/notification\";import{useAuth,useQueryParams}from\"../../utilities\";import{generateCustomerToken}from\"../../../services/authService\";import CryptoJS from\"crypto-js\";var _process$env=process.env,REACT_APP_LOAN_API_PROXY_URL=_process$env.REACT_APP_LOAN_API_PROXY_URL,REACT_APP_SECRET_KEY=_process$env.REACT_APP_SECRET_KEY;var CreateNewLoanApplication=function CreateNewLoanApplication(props){var history=useHistory();var auth=useAuth();// useCallback ensures that handle error function isn't recreated on every render\nvar handleError=useCallback(function(errorObject,notify,cb){return errorHandler(auth)(errorObject,notify,cb);},[auth]);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),customerToken=_useState4[0],setCustomerToken=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),loansURL=_useState6[0],setLoansURL=_useState6[1];var queryParams=useQueryParams();var customerId=useMemo(function(){return queryParams.get(\"customer_id\");},[queryParams]);useEffect(function(){function handleGenerateCustomerToken(_x){return _handleGenerateCustomerToken.apply(this,arguments);}function _handleGenerateCustomerToken(){_handleGenerateCustomerToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(userId){var result,wasUserFound;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;_context.next=4;return generateCustomerToken(userId);case 4:result=_context.sent;setLoading(false);wasUserFound=result.message!==\"User not found\";notify(wasUserFound?\"Successful\":result.message,!wasUserFound?\"error\":\"success\");if(!(!wasUserFound||!result.token)){_context.next=11;break;}history.push(\"/loanMan/new/selectCustomer\");return _context.abrupt(\"return\");case 11:if(result.token)setCustomerToken(result.token);_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](1);console.log(_context.t0);handleError(_context.t0,notify,function(){return setLoading(false);});case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,14]]);}));return _handleGenerateCustomerToken.apply(this,arguments);}handleGenerateCustomerToken(customerId);},[customerId,handleError,history]);useEffect(function(){if(customerToken){encryptToken(customerToken);}},[customerToken]);var encryptToken=function encryptToken(token){var ciphertext=CryptoJS.AES.encrypt(token,REACT_APP_SECRET_KEY).toString();var url=\"\".concat(REACT_APP_LOAN_API_PROXY_URL,\"/apply/loans?auth=\").concat(ciphertext);setLoansURL(url);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"header\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"h1\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(e){return history.goBack();},className:\"btn btn-primary back-btn\",children:/*#__PURE__*/_jsx(TimesIcon,{})}),\"New Loan Application\"]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"small-admin-details\",children:[/*#__PURE__*/_jsx(\"img\",{src:face,alt:\"\"}),\"NPF Admin\",/*#__PURE__*/_jsx(\"i\",{className:\"arrow down\"})]})})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"customers-page\",children:[(isLoading||!customerToken)&&/*#__PURE__*/_jsxs(\"div\",{className:\"searching-block\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"svg-holder \"+(!isLoading?\"not-loading\":\"\"),children:isLoading?/*#__PURE__*/_jsx(SpinnerIcon,{className:\"rotating\"}):/*#__PURE__*/_jsx(NothingFoundIcon,{})}),!isLoading&&/*#__PURE__*/_jsx(\"p\",{children:\"NOTHING FOUND!\"})]}),!isLoading&&!!loansURL&&/*#__PURE__*/ // Styles are just for fast; review if needed\n_jsx(\"div\",{className:\"customer-details\",style:{backgroundColor:\"#f8fafd\"},children:/*#__PURE__*/_jsx(\"div\",{className:\"\",children:/*#__PURE__*/_jsx(\"iframe\",{src:loansURL,width:\"100%\",height:\"749px\",style:{border:\"none\"},title:\"Loan Application\"})})})]})]});};export default CreateNewLoanApplication;","map":{"version":3,"sources":["/Users/xerde2/Downloads/npf-admin-web/src/components/loanManagement/newApplications/createNewLoanApplication.js"],"names":["React","Fragment","useState","useEffect","useCallback","useMemo","useHistory","face","errorHandler","notify","useAuth","useQueryParams","generateCustomerToken","CryptoJS","process","env","REACT_APP_LOAN_API_PROXY_URL","REACT_APP_SECRET_KEY","CreateNewLoanApplication","props","history","auth","handleError","errorObject","cb","isLoading","setLoading","customerToken","setCustomerToken","loansURL","setLoansURL","queryParams","customerId","get","handleGenerateCustomerToken","userId","result","wasUserFound","message","token","push","console","log","encryptToken","ciphertext","AES","encrypt","toString","url","e","goBack","backgroundColor","border"],"mappings":"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","sourcesContent":["// Checkboxes beside customers are commented out to until feature to export data of selected customers is needed\n// -----------------------------------------------\nimport React, {\n  Fragment,\n  useState,\n  useEffect,\n  useCallback,\n  useMemo,\n} from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport face from \"../../../assets/img/placeholder-img.png\";\nimport { ReactComponent as TimesIcon } from \"../../../assets/icons/times.svg\";\nimport { ReactComponent as SpinnerIcon } from \"../../../assets/icons/spinner.svg\";\nimport { ReactComponent as NothingFoundIcon } from \"../../../assets/icons/nothing-found.svg\";\nimport errorHandler from \"../../../utils/errorHandler\";\nimport notify from \"../../../utils/notification\";\nimport { useAuth, useQueryParams } from \"../../utilities\";\nimport { generateCustomerToken } from \"../../../services/authService\";\nimport CryptoJS from \"crypto-js\";\nconst { REACT_APP_LOAN_API_PROXY_URL, REACT_APP_SECRET_KEY } = process.env;\n\nconst CreateNewLoanApplication = (props) => {\n  const history = useHistory();\n  const auth = useAuth();\n  // useCallback ensures that handle error function isn't recreated on every render\n  const handleError = useCallback(\n    (errorObject, notify, cb) => errorHandler(auth)(errorObject, notify, cb),\n    [auth]\n  );\n  const [isLoading, setLoading] = useState(false);\n\n  const [customerToken, setCustomerToken] = useState(\"\");\n  const [loansURL, setLoansURL] = useState(\"\");\n  const queryParams = useQueryParams();\n  const customerId = useMemo(\n    () => queryParams.get(\"customer_id\"),\n    [queryParams]\n  );\n\n  useEffect(() => {\n    async function handleGenerateCustomerToken(userId) {\n      setLoading(true);\n      try {\n        const result = await generateCustomerToken(userId);\n        setLoading(false);\n        const wasUserFound = result.message !== \"User not found\";\n        notify(\n          wasUserFound ? \"Successful\" : result.message,\n          !wasUserFound ? \"error\" : \"success\"\n        );\n        if (!wasUserFound || !result.token) {\n          history.push(\"/loanMan/new/selectCustomer\");\n          return;\n        }\n        if (result.token) setCustomerToken(result.token);\n      } catch (error) {\n        console.log(error);\n        handleError(error, notify, () => setLoading(false));\n      }\n    }\n\n    handleGenerateCustomerToken(customerId);\n  }, [customerId, handleError, history]);\n\n  useEffect(() => {\n    if (customerToken) {\n      encryptToken(customerToken);\n    }\n  }, [customerToken]);\n\n  const encryptToken = (token) => {\n    var ciphertext = CryptoJS.AES.encrypt(\n      token,\n      REACT_APP_SECRET_KEY\n    ).toString();\n\n    const url = `${REACT_APP_LOAN_API_PROXY_URL}/apply/loans?auth=${ciphertext}`;\n    setLoansURL(url);\n  };\n\n  return (\n    <>\n      <header>\n        <div>\n          <h1>\n            <button\n              onClick={(e) => history.goBack()}\n              className=\"btn btn-primary back-btn\"\n            >\n              <TimesIcon />\n            </button>\n            New Loan Application\n          </h1>\n        </div>\n        <div>\n          <div className=\"small-admin-details\">\n            <img src={face} alt=\"\" />\n            NPF Admin\n            <i className=\"arrow down\"></i>\n          </div>\n        </div>\n      </header>\n      <main className=\"customers-page\">\n        {(isLoading || !customerToken) && (\n          <div className=\"searching-block\">\n            <div className={\"svg-holder \" + (!isLoading ? \"not-loading\" : \"\")}>\n              {isLoading ? (\n                <SpinnerIcon className=\"rotating\" />\n              ) : (\n                <NothingFoundIcon />\n              )}\n            </div>\n            {!isLoading && <p>NOTHING FOUND!</p>}\n          </div>\n        )}\n        {!isLoading && !!loansURL && (\n          // Styles are just for fast; review if needed\n          <div\n            className=\"customer-details\"\n            style={{ backgroundColor: \"#f8fafd\" }}\n          >\n            <div className=\"\">\n              <iframe\n                src={loansURL}\n                width=\"100%\"\n                height=\"749px\"\n                style={{ border: \"none\" }}\n                title=\"Loan Application\"\n              />\n            </div>\n          </div>\n        )}\n      </main>\n    </>\n  );\n};\n\nexport default CreateNewLoanApplication;\n"]},"metadata":{},"sourceType":"module"}