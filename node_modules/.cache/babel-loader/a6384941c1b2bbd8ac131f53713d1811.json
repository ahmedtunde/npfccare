{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/xerde2/Downloads/npf-admin-web/src/components/loanManagement/newApplications/createNewLoanApplication.js\",\n    _s = $RefreshSig$();\n\n// Checkboxes beside customers are commented out to until feature to export data of selected customers is needed\n// -----------------------------------------------\nimport React, { Fragment, useState, useEffect, useCallback, useMemo } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport face from \"../../../assets/img/placeholder-img.png\";\nimport { ReactComponent as TimesIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../../../assets/icons/times.svg\";\nimport { ReactComponent as SpinnerIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../../../assets/icons/spinner.svg\";\nimport { ReactComponent as NothingFoundIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../../../assets/icons/nothing-found.svg\";\nimport errorHandler from \"../../../utils/errorHandler\";\nimport notify from \"../../../utils/notification\";\nimport { useAuth, useQueryParams } from \"../../utilities\";\nimport { generateCustomerToken } from \"../../../services/authService\";\nimport CryptoJS from \"crypto-js\";\nconst {\n  REACT_APP_LOAN_API_PROXY_URL,\n  REACT_APP_SECRET_KEY\n} = process.env;\n\nconst CreateNewLoanApplication = props => {\n  _s();\n\n  const history = useHistory();\n  const auth = useAuth(); // useCallback ensures that handle error function isn't recreated on every render\n\n  const handleError = useCallback((errorObject, notify, cb) => errorHandler(auth)(errorObject, notify, cb), [auth]);\n  const [isLoading, setLoading] = useState(false);\n  const [customerToken, setCustomerToken] = useState(\"\");\n  const [loansURL, setLoansURL] = useState(\"\");\n  const queryParams = useQueryParams();\n  const customerId = useMemo(() => queryParams.get(\"customer_id\"), [queryParams]);\n  useEffect(() => {\n    async function handleGenerateCustomerToken(userId) {\n      setLoading(true);\n\n      try {\n        const result = await generateCustomerToken(userId);\n        setLoading(false);\n        const wasUserFound = result.message !== \"User not found\";\n        notify(wasUserFound ? \"Successful\" : result.message, !wasUserFound ? \"error\" : \"success\");\n\n        if (!wasUserFound || !result.token) {\n          history.push(\"/loanMan/new/selectCustomer\");\n          return;\n        }\n\n        if (result.token) setCustomerToken(result.token);\n      } catch (error) {\n        console.log(error);\n        handleError(error, notify, () => setLoading(false));\n      }\n    }\n\n    handleGenerateCustomerToken(customerId);\n  }, [customerId, handleError, history]);\n  useEffect(() => {\n    if (customerToken) {\n      encryptToken(customerToken);\n    }\n  }, [customerToken]);\n\n  const encryptToken = token => {\n    var ciphertext = CryptoJS.AES.encrypt(token, REACT_APP_SECRET_KEY).toString();\n    const url = `${REACT_APP_LOAN_API_PROXY_URL}/apply/loans?auth=${ciphertext}`;\n    setLoansURL(url);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: e => history.goBack(),\n            className: \"btn btn-primary back-btn\",\n            children: /*#__PURE__*/_jsxDEV(TimesIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 90,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 13\n          }, this), \"New Loan Application\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"small-admin-details\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: face,\n            alt: \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 13\n          }, this), \"NPF Admin\", /*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"arrow down\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"customers-page\",\n      children: [(isLoading || !customerToken) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"searching-block\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"svg-holder \" + (!isLoading ? \"not-loading\" : \"\"),\n          children: isLoading ? /*#__PURE__*/_jsxDEV(SpinnerIcon, {\n            className: \"rotating\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(NothingFoundIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, this), !isLoading && /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"NOTHING FOUND!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 28\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this), !isLoading && !!loansURL &&\n      /*#__PURE__*/\n      // Styles are just for fast; review if needed\n      _jsxDEV(\"div\", {\n        className: \"customer-details\",\n        style: {\n          backgroundColor: \"#f8fafd\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: /*#__PURE__*/_jsxDEV(\"iframe\", {\n            src: loansURL,\n            width: \"100%\",\n            height: \"749px\",\n            style: {\n              border: \"none\"\n            },\n            title: \"Loan Application\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(CreateNewLoanApplication, \"rIU33Z+5R1s+GoySTGRzcnId6Wg=\", false, function () {\n  return [useHistory, useAuth, useQueryParams];\n});\n\n_c = CreateNewLoanApplication;\nexport default CreateNewLoanApplication;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateNewLoanApplication\");","map":{"version":3,"sources":["/Users/xerde2/Downloads/npf-admin-web/src/components/loanManagement/newApplications/createNewLoanApplication.js"],"names":["React","Fragment","useState","useEffect","useCallback","useMemo","useHistory","face","errorHandler","notify","useAuth","useQueryParams","generateCustomerToken","CryptoJS","REACT_APP_LOAN_API_PROXY_URL","REACT_APP_SECRET_KEY","process","env","CreateNewLoanApplication","props","history","auth","handleError","errorObject","cb","isLoading","setLoading","customerToken","setCustomerToken","loansURL","setLoansURL","queryParams","customerId","get","handleGenerateCustomerToken","userId","result","wasUserFound","message","token","push","error","console","log","encryptToken","ciphertext","AES","encrypt","toString","url","e","goBack","backgroundColor","border"],"mappings":"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","sourcesContent":["// Checkboxes beside customers are commented out to until feature to export data of selected customers is needed\n// -----------------------------------------------\nimport React, {\n  Fragment,\n  useState,\n  useEffect,\n  useCallback,\n  useMemo,\n} from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport face from \"../../../assets/img/placeholder-img.png\";\nimport { ReactComponent as TimesIcon } from \"../../../assets/icons/times.svg\";\nimport { ReactComponent as SpinnerIcon } from \"../../../assets/icons/spinner.svg\";\nimport { ReactComponent as NothingFoundIcon } from \"../../../assets/icons/nothing-found.svg\";\nimport errorHandler from \"../../../utils/errorHandler\";\nimport notify from \"../../../utils/notification\";\nimport { useAuth, useQueryParams } from \"../../utilities\";\nimport { generateCustomerToken } from \"../../../services/authService\";\nimport CryptoJS from \"crypto-js\";\nconst { REACT_APP_LOAN_API_PROXY_URL, REACT_APP_SECRET_KEY } = process.env;\n\nconst CreateNewLoanApplication = (props) => {\n  const history = useHistory();\n  const auth = useAuth();\n  // useCallback ensures that handle error function isn't recreated on every render\n  const handleError = useCallback(\n    (errorObject, notify, cb) => errorHandler(auth)(errorObject, notify, cb),\n    [auth]\n  );\n  const [isLoading, setLoading] = useState(false);\n\n  const [customerToken, setCustomerToken] = useState(\"\");\n  const [loansURL, setLoansURL] = useState(\"\");\n  const queryParams = useQueryParams();\n  const customerId = useMemo(\n    () => queryParams.get(\"customer_id\"),\n    [queryParams]\n  );\n\n  useEffect(() => {\n    async function handleGenerateCustomerToken(userId) {\n      setLoading(true);\n      try {\n        const result = await generateCustomerToken(userId);\n        setLoading(false);\n        const wasUserFound = result.message !== \"User not found\";\n        notify(\n          wasUserFound ? \"Successful\" : result.message,\n          !wasUserFound ? \"error\" : \"success\"\n        );\n        if (!wasUserFound || !result.token) {\n          history.push(\"/loanMan/new/selectCustomer\");\n          return;\n        }\n        if (result.token) setCustomerToken(result.token);\n      } catch (error) {\n        console.log(error);\n        handleError(error, notify, () => setLoading(false));\n      }\n    }\n\n    handleGenerateCustomerToken(customerId);\n  }, [customerId, handleError, history]);\n\n  useEffect(() => {\n    if (customerToken) {\n      encryptToken(customerToken);\n    }\n  }, [customerToken]);\n\n  const encryptToken = (token) => {\n    var ciphertext = CryptoJS.AES.encrypt(\n      token,\n      REACT_APP_SECRET_KEY\n    ).toString();\n\n    const url = `${REACT_APP_LOAN_API_PROXY_URL}/apply/loans?auth=${ciphertext}`;\n    setLoansURL(url);\n  };\n\n  return (\n    <>\n      <header>\n        <div>\n          <h1>\n            <button\n              onClick={(e) => history.goBack()}\n              className=\"btn btn-primary back-btn\"\n            >\n              <TimesIcon />\n            </button>\n            New Loan Application\n          </h1>\n        </div>\n        <div>\n          <div className=\"small-admin-details\">\n            <img src={face} alt=\"\" />\n            NPF Admin\n            <i className=\"arrow down\"></i>\n          </div>\n        </div>\n      </header>\n      <main className=\"customers-page\">\n        {(isLoading || !customerToken) && (\n          <div className=\"searching-block\">\n            <div className={\"svg-holder \" + (!isLoading ? \"not-loading\" : \"\")}>\n              {isLoading ? (\n                <SpinnerIcon className=\"rotating\" />\n              ) : (\n                <NothingFoundIcon />\n              )}\n            </div>\n            {!isLoading && <p>NOTHING FOUND!</p>}\n          </div>\n        )}\n        {!isLoading && !!loansURL && (\n          // Styles are just for fast; review if needed\n          <div\n            className=\"customer-details\"\n            style={{ backgroundColor: \"#f8fafd\" }}\n          >\n            <div className=\"\">\n              <iframe\n                src={loansURL}\n                width=\"100%\"\n                height=\"749px\"\n                style={{ border: \"none\" }}\n                title=\"Loan Application\"\n              />\n            </div>\n          </div>\n        )}\n      </main>\n    </>\n  );\n};\n\nexport default CreateNewLoanApplication;\n"]},"metadata":{},"sourceType":"module"}